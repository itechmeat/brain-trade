# Этап 9: Система экспертов и промптов

## Настройка ИИ-экспертов и их промптов

### Шаг 9.1: Создание базы данных экспертов
- [ ] Создать `src/data/experts.json` с описанием экспертов:
  ```json
  {
    "experts": [
      {
        "id": "business_analyst",
        "name": "Бизнес-аналитик",
        "avatar": "/experts/business-analyst.jpg",
        "expertise": ["Бизнес-анализ", "Требования", "Процессы"],
        "description": "Эксперт по анализу бизнес-требований и процессов",
        "systemPrompt": "Ты опытный бизнес-аналитик...",
        "preferredModel": "gpt-4o",
        "isActive": true
      }
    ]
  }
  ```

### Шаг 9.2: Система промптов для экспертов
- [ ] Создать `src/lib/prompts/` структуру:
  - `base-prompts.ts` - базовые промпты
  - `expert-prompts.ts` - промпты для каждого эксперта
  - `system-prompts.ts` - системные промпты
  - `prompt-builder.ts` - построитель промптов

### Шаг 9.3: Промпты для различных типов экспертов
- [ ] Создать промпты для бизнес-экспертов:
  - Стратегический консультант
  - Продуктовый менеджер
  - Маркетинговый эксперт
  - Финансовый аналитик
- [ ] Создать промпты для технических экспертов:
  - Архитектор решений
  - DevOps инженер
  - Frontend разработчик
  - Backend разработчик
  - QA инженер

### Шаг 9.4: Система ролей и персонажей
- [ ] Определить роли экспертов:
  ```typescript
  interface ExpertRole {
    id: string;
    name: string;
    personality: string;
    communicationStyle: string;
    expertise: string[];
    restrictions: string[];
  }
  ```
- [ ] Создать детальные персонажи для каждого эксперта
- [ ] Добавить уникальные особенности общения

### Шаг 9.5: Контекстно-зависимые промпты
- [ ] Создать систему адаптации промптов под контекст:
  - Анализ предыдущих сообщений
  - Определение темы разговора
  - Адаптация стиля под пользователя
- [ ] Реализовать динамическое построение промптов

### Шаг 9.6: Интеграция с RAG системой
- [ ] Создать промпты для работы с RAG:
  - Инструкции по использованию контекста
  - Правила цитирования источников
  - Обработка конфликтующей информации
- [ ] Добавить специализированные промпты для каждого эксперта с RAG

### Шаг 9.7: Система взаимодействия экспертов
- [ ] Создать промпты для коллаборации:
  - Правила обращения к другим экспертам
  - Передача контекста между экспертами
  - Разрешение конфликтов мнений
- [ ] Реализовать систему "эстафеты" между экспертами

### Шаг 9.8: Адаптивные промпты
- [ ] Создать систему A/B тестирования промптов
- [ ] Реализовать адаптацию промптов по обратной связи
- [ ] Добавить версионирование промптов

### Шаг 9.9: Конфигурация экспертов
- [ ] Создать `src/config/experts-config.ts`:
  ```typescript
  interface ExpertConfig {
    id: string;
    name: string;
    model: AIModel;
    temperature: number;
    maxTokens: number;
    systemPrompt: string;
    ragEnabled: boolean;
    ragCollection: string;
  }
  ```

### Шаг 9.10: Загрузчик экспертов
- [ ] Создать `src/lib/experts/experts-loader.ts`:
  - Загрузка конфигурации экспертов
  - Валидация данных экспертов
  - Кеширование конфигураций
- [ ] Добавить hot-reload для разработки

### Шаг 9.11: Менеджер экспертов
- [ ] Создать `src/lib/experts/experts-manager.ts`:
  - Управление активными экспертами
  - Балансировка нагрузки
  - Мониторинг производительности
- [ ] Реализовать fallback стратегии

### Шаг 9.12: Персонализация экспертов
- [ ] Добавить возможность пользователям:
  - Настраивать предпочтения экспертов
  - Создавать кастомных экспертов
  - Сохранять любимые комбинации экспертов

### Шаг 9.13: Метрики и аналитика
- [ ] Добавить отслеживание:
  - Популярности экспертов
  - Качества ответов
  - Времени отклика
  - Использования RAG

### Шаг 9.14: Тестирование системы экспертов
- [ ] Создать тесты для:
  - Загрузки конфигураций экспертов
  - Построения промптов
  - Взаимодействия экспертов
  - RAG интеграции

## Результат этапа
После завершения этого этапа у вас будет:
- ✅ База данных экспертов с детальными профилями
- ✅ Система промптов для каждого типа эксперта
- ✅ Контекстно-зависимые и адаптивные промпты
- ✅ Интеграция промптов с RAG системой
- ✅ Система взаимодействия между экспертами
- ✅ Менеджер для управления экспертами
- ✅ Персонализация и настройки экспертов
- ✅ Метрики и аналитика использования