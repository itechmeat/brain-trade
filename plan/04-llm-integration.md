# Этап 4: Интеграция с LLM провайдерами

## Настройка подключений к различным LLM сервисам

### Шаг 4.1: Базовые утилиты для работы с AI
- [ ] Скопировать и адаптировать `src/lib/api/ai-utils.ts` из venture-agent
- [ ] Скопировать и адаптировать `src/lib/api/gemini-utils.ts` для Google Gemini
- [ ] Создать общий базовый обработчик `src/lib/api/base-handler.ts`
- [ ] Создать типы для AI провайдеров в `src/types/ai.ts`

### Шаг 4.2: Настройка OpenAI интеграции
- [ ] Создать конфигурацию для OpenAI клиента
- [ ] Реализовать функции для работы с GPT моделями:
  - Отправка сообщений
  - Стриминг ответов
  - Обработка ошибок
- [ ] Добавить поддержку различных моделей GPT (gpt-4o, gpt-4o-mini, gpt-3.5-turbo)

### Шаг 4.3: Настройка Anthropic Claude интеграции
- [ ] Настроить Anthropic SDK или прямые HTTP вызовы
- [ ] Реализовать функции для работы с Claude моделями
- [ ] Добавить поддержку различных версий Claude (claude-3-5-sonnet, claude-3-haiku)
- [ ] Настроить правильное форматирование промптов для Claude

### Шаг 4.4: Настройка Google Gemini интеграции
- [ ] Адаптировать gemini-utils для работы с Gemini API
- [ ] Настроить аутентификацию с Google AI
- [ ] Реализовать функции для работы с Gemini моделями
- [ ] Добавить поддержку Gemini Pro и Gemini Flash

### Шаг 4.5: Создание унифицированного интерфейса для LLM
- [ ] Создать абстрактный интерфейс для всех LLM провайдеров
- [ ] Реализовать фабрику для создания LLM клиентов
- [ ] Добавить типизацию для различных типов сообщений
- [ ] Создать утилиты для переключения между провайдерами

### Шаг 4.6: Обработка ошибок и ретраи
- [ ] Реализовать обработку ошибок для каждого провайдера
- [ ] Добавить механизм retry для неудачных запросов
- [ ] Создать fallback логику при недоступности провайдера
- [ ] Логирование ошибок и метрики использования

### Шаг 4.7: Настройка middleware для API
- [ ] Скопировать и адаптировать `src/lib/api/middleware/` из venture-agent
- [ ] Создать CORS middleware
- [ ] Создать аутентификацию middleware (если нужна)
- [ ] Добавить rate limiting middleware
- [ ] Создать индексный файл для middleware

### Шаг 4.8: Создание конфигурации моделей
- [ ] Создать файл с настройками доступных моделей
- [ ] Добавить лимиты токенов для каждой модели
- [ ] Настроить цены и ограничения для каждого провайдера
- [ ] Создать селектор модели по умолчанию

### Шаг 4.9: Тестирование интеграций
- [ ] Создать тестовые скрипты для каждого провайдера
- [ ] Проверить работу с переменными окружения
- [ ] Протестировать обработку ошибок
- [ ] Убедиться в корректном форматировании ответов

## Результат этапа
После завершения этого этапа у вас будет:
- ✅ Интеграция с OpenAI GPT моделями
- ✅ Интеграция с Anthropic Claude
- ✅ Интеграция с Google Gemini
- ✅ Унифицированный интерфейс для всех LLM
- ✅ Обработка ошибок и retry логика
- ✅ Middleware для API запросов
- ✅ Готовность к созданию API эндпоинтов